<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Standoff 2 –†—É–ª–µ—Ç–∫–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background: #0f1217;
            color: white;
            display: flex;
            justify-content: center;
            padding: 20px;
        }
        
        .app {
            max-width: 500px;
            width: 100%;
            background: #1a1e26;
            border-radius: 30px;
            padding: 20px;
        }
        
        .profile {
            background: #232a34;
            padding: 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid gold;
        }
        
        .name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .balance {
            background: black;
            padding: 8px 15px;
            border-radius: 50px;
            border: 1px solid gold;
            display: inline-block;
        }
        
        .balance span {
            color: gold;
            font-size: 22px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .wheel-box {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 20px auto;
        }
        
        canvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 5px solid gold;
            box-shadow: 0 0 20px gold;
        }
        
        .pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 40px;
            color: gold;
            text-shadow: 0 0 10px gold;
            z-index: 10;
        }
        
        .result {
            background: #232a34;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 32px;
            font-weight: bold;
            color: gold;
            margin: 20px 0;
            border: 1px solid gold;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .btn:active {
            transform: scale(0.97);
        }
        
        .btn:disabled {
            opacity: 0.5;
            transform: none;
            cursor: not-allowed;
        }
        
        .btn-free {
            background: #27ae60;
            box-shadow: 0 5px 0 #1e8449;
        }
        
        .btn-paid {
            background: #c0392b;
            box-shadow: 0 5px 0 #962d22;
        }
        
        .timer {
            font-size: 12px;
            background: rgba(0,0,0,0.5);
            padding: 3px 10px;
            border-radius: 20px;
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="profile">
            <img id="avatar" class="avatar" src="" alt="avatar">
            <div>
                <div id="username" class="name">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <div class="balance">
                    üí∞ <span id="balance">100</span> G
                </div>
            </div>
        </div>
        
        <div class="wheel-box">
            <canvas id="wheel" width="400" height="400"></canvas>
            <div class="pointer">‚ñº</div>
        </div>
        
        <div id="result" class="result">üé≤ –ö–†–£–¢–ò!</div>
        
        <div class="buttons">
            <button id="freeBtn" class="btn btn-free">
                üéÅ –ë–ï–°–ü–õ–ê–¢–ù–û
                <span id="timer" class="timer"></span>
            </button>
            <button id="paidBtn" class="btn btn-paid">
                ‚ö° –ó–ê 10G
            </button>
        </div>
    </div>
    
    <script>
        const tg = Telegram.WebApp;
        tg.ready();
        tg.expand();
        
        const user = tg.initDataUnsafe?.user || {
            first_name: '–ò–≥—Ä–æ–∫',
            id: Date.now()
        };
        
        document.getElementById('username').innerText = user.first_name;
        document.getElementById('avatar').src = user.photo_url || `https://ui-avatars.com/api/?name=${user.first_name}&background=ffd700&color=000&size=128`;
        
        // ============ –ù–ê–°–¢–†–û–ô–ö–ò ============
        const SECTORS = [
            { value: 250, color: '#c0392b' }, // 0¬∞   - –í–ï–†–•
            { value: 100, color: '#e84342' }, // 45¬∞
            { value: 50, color: '#9b59b6' },  // 90¬∞
            { value: 25, color: '#3498db' },  // 135¬∞
            { value: 15, color: '#2ecc71' },  // 180¬∞
            { value: 10, color: '#f1c40f' },  // 225¬∞
            { value: 5, color: '#e67e22' },   // 270¬∞
            { value: 0, color: '#e74c3c' }    // 315¬∞
        ];
        
        const FREE_CHANCES = [0.01, 0.1, 0.7, 1.8, 4, 7.5, 15, 70.89];
        const PAID_CHANCES = [0.1, 0.5, 2, 5, 10, 15, 17.4, 50];
        
        // ============ –ü–ï–†–ï–ú–ï–ù–ù–´–ï ============
        let balance = 100;
        let lastFree = null;
        let isSpinning = false;
        let rotation = 0;
        let animFrame = null;
        
        const canvas = document.getElementById('wheel');
        const ctx = canvas.getContext('2d');
        
        // ============ –ó–ê–ì–†–£–ó–ö–ê ============
        const saved = localStorage.getItem(`game_${user.id}`);
        if (saved) {
            const data = JSON.parse(saved);
            balance = data.balance || 100;
            lastFree = data.lastFree || null;
        }
        
        // ============ –û–¢–†–ò–°–û–í–ö–ê ============
        function drawWheel(angle = 0) {
            const w = 400, h = 400;
            const cx = 200, cy = 200;
            const r = 170;
            
            ctx.clearRect(0, 0, w, h);
            
            for (let i = 0; i < SECTORS.length; i++) {
                const start = i * 0.7854 + angle;
                const end = start + 0.7854;
                
                ctx.beginPath();
                ctx.moveTo(cx, cy);
                ctx.arc(cx, cy, r, start, end);
                ctx.closePath();
                
                ctx.fillStyle = SECTORS[i].color;
                ctx.fill();
                ctx.strokeStyle = 'black';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                ctx.save();
                ctx.translate(cx, cy);
                ctx.rotate(start + 0.3927);
                ctx.textAlign = 'center';
                ctx.font = 'bold 24px Arial';
                ctx.fillStyle = 'white';
                ctx.shadowColor = 'black';
                ctx.shadowBlur = 5;
                ctx.fillText(SECTORS[i].value, 110, 0);
                ctx.restore();
            }
            
            ctx.beginPath();
            ctx.arc(cx, cy, 25, 0, 7);
            ctx.fillStyle = 'gold';
            ctx.fill();
        }
        
        // ============ –í–†–ê–©–ï–ù–ò–ï - –ò–°–ü–†–ê–í–õ–ï–ù–û! ============
        function spinTo(value) {
            const index = SECTORS.findIndex(s => s.value === value);
            // –í–ê–ñ–ù–û: –°—Ç—Ä–µ–ª–∫–∞ –Ω–∞–≤–µ—Ä—Ö—É —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ì–†–ê–ù–ò–¶–£ —Å–µ–∫—Ç–æ—Ä–æ–≤!
            const targetAngle = (index * 45) * 0.0174533; // –£–±—Ä–∞–ª +22.5!
            
            return new Promise((resolve) => {
                if (isSpinning) return;
                isSpinning = true;
                
                const start = rotation;
                const end = rotation + (8 * 6.2832) + targetAngle - (rotation % 6.2832);
                const startTime = performance.now();
                
                function animate(time) {
                    const elapsed = time - startTime;
                    const progress = Math.min(elapsed / 3000, 1);
                    const ease = 1 - Math.pow(1 - progress, 3);
                    
                    rotation = start + (end - start) * ease;
                    drawWheel(rotation);
                    
                    if (progress < 1) {
                        animFrame = requestAnimationFrame(animate);
                    } else {
                        rotation = end % 6.2832;
                        drawWheel(rotation);
                        isSpinning = false;
                        resolve();
                    }
                }
                
                animFrame = requestAnimationFrame(animate);
            });
        }
        
        // ============ –í–´–ë–û–† –í–´–ò–ì–†–´–®–ê ============
        function getWin(isPaid) {
            const chances = isPaid ? PAID_CHANCES : FREE_CHANCES;
            const rand = Math.random() * 100;
            let sum = 0;
            
            for (let i = 0; i < chances.length; i++) {
                sum += chances[i];
                if (rand < sum) {
                    console.log(`üé≤ –í—ã–∏–≥—Ä—ã—à: ${SECTORS[i].value}G (—Å–µ–∫—Ç–æ—Ä ${i})`);
                    return SECTORS[i].value;
                }
            }
            return 0;
        }
        
        // ============ –ö–†–£–¢–ö–ê ============
        async function spin(isPaid) {
            if (isSpinning) {
                tg.showAlert('–ö—Ä—É—Ç–∏—Ç—Å—è!');
                return;
            }
            
            if (!isPaid) {
                if (lastFree) {
                    const hours = (Date.now() - lastFree) / 3600000;
                    if (hours < 24) {
                        tg.showAlert('–ü–æ–¥–æ–∂–¥–∏—Ç–µ ' + Math.floor(24 - hours) + '—á');
                        return;
                    }
                }
            }
            
            if (isPaid && balance < 10) {
                tg.showAlert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ G!');
                return;
            }
            
            document.getElementById('freeBtn').disabled = true;
            document.getElementById('paidBtn').disabled = true;
            
            if (isPaid) {
                balance -= 10;
                document.getElementById('balance').innerText = balance;
            }
            
            const winValue = getWin(isPaid);
            document.getElementById('result').innerHTML = 'üé∞ –ö–†–£–¢–ò–ú...';
            
            await spinTo(winValue);
            
            balance += winValue;
            document.getElementById('balance').innerText = balance;
            
            if (!isPaid) {
                lastFree = Date.now();
            }
            
            localStorage.setItem(`game_${user.id}`, JSON.stringify({
                balance: balance,
                lastFree: lastFree
            }));
            
            if (winValue >= 100) {
                document.getElementById('result').innerHTML = `üî• +${winValue}G üî•`;
                tg.HapticFeedback.impactOccurred('heavy');
            } else if (winValue >= 50) {
                document.getElementById('result').innerHTML = `‚ö° +${winValue}G ‚ö°`;
                tg.HapticFeedback.impactOccurred('medium');
            } else if (winValue > 0) {
                document.getElementById('result').innerHTML = `üéâ +${winValue}G`;
                tg.HapticFeedback.impactOccurred('light');
            } else {
                document.getElementById('result').innerHTML = `üíî 0G`;
                tg.HapticFeedback.notificationOccurred('error');
            }
            
            document.getElementById('paidBtn').disabled = balance < 10;
            updateTimer();
        }
        
        function updateTimer() {
            const timerEl = document.getElementById('timer');
            
            if (!lastFree) {
                document.getElementById('freeBtn').disabled = false;
                timerEl.innerText = '–ì–æ—Ç–æ–≤–æ';
                return;
            }
            
            const hours = (Date.now() - lastFree) / 3600000;
            
            if (hours >= 24) {
                document.getElementById('freeBtn').disabled = false;
                timerEl.innerText = '–ì–æ—Ç–æ–≤–æ';
            } else {
                document.getElementById('freeBtn').disabled = true;
                const left = 24 - hours;
                timerEl.innerText = `${Math.floor(left)}—á ${Math.floor((left % 1) * 60)}–º`;
            }
        }
        
        document.getElementById('freeBtn').onclick = () => spin(false);
        document.getElementById('paidBtn').onclick = () => spin(true);
        
        drawWheel();
        document.getElementById('balance').innerText = balance;
        document.getElementById('paidBtn').disabled = balance < 10;
        updateTimer();
        
        setInterval(updateTimer, 60000);
        
        window.onbeforeunload = () => {
            if (animFrame) cancelAnimationFrame(animFrame);
            localStorage.setItem(`game_${user.id}`, JSON.stringify({
                balance: balance,
                lastFree: lastFree
            }));
        };
    </script>
</body>
</html>